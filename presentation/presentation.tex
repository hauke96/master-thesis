\documentclass[xcolor={x11names}]{beamer}
\input{flat-blue-theme.inc}
\input{footnotes.inc}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[ngerman,english]{babel}
\usepackage[english]{datetime2}
\usepackage{microtype}
\usepackage{csquotes}

%
% Tables
%
\usepackage{tabularx}
\usepackage{booktabs}

% Make spacing in tables slightly larger
%\renewcommand{\arraystretch}{1.15}
\newcolumntype{R}{>{\raggedleft\arraybackslash}X}

%
% TikZ
%
\usepackage{tikz}
\usetikzlibrary{
	arrows,
	arrows.meta,
	calc,
%	external,
	fadings,
	intersections,
	patterns,
	positioning,
	snakes
}
%\tikzexternalize[prefix=tikz-cache/]

\tikzset{every path/.append style={line width=0.5pt}}
\tikzset{every path/.append style={>=stealth'}}
\tikzset{
	between/.style args={#1 and #2}{
		at = ($(#1)!0.5!(#2)$)
	}
}
\tikzset{
	dot/.style={circle,fill,inner sep=0.4mm,outer sep=0.25mm}
}
% [params] pos id
\newcommand{\tikzDot}[3][]{\node (#3) at #2 [dot,#1]{};}

%
% BibTex
%

% Must be placed here before BibTeX and URL/ref related packages:
\PassOptionsToPackage{obeyspaces}{url} % Allow spaces in URLs
\PassOptionsToPackage{spaces}{url}     % Enable line breaks in URLs

\usepackage[toc, page]{appendix}
\usepackage[
	backend=bibtex8,
	style=numeric,
	sorting=none,
	urldate=long,
	backref
]{biblatex}
\usepackage{hyperref}
\usepackage[noabbrev]{cleveref}

\addbibresource{sources.bib}
\let\oldCite\cite
\renewcommand{\cite}[2][]{ \oldCite[#1]{#2}} % Add space before citation

\NewBibliographyString{diplomathesis}
\DefineBibliographyStrings{english}{
	diplomathesis = {diploma thesis},
}

%
% Commands
%

\newcommand{\bigo}[1]{\mathcal{O}(#1)}
\renewcommand{\n}{\hfill\\[0.5ex]}
\newcommand{\nn}{\hfill\\[2ex]}

% Environment to center content of a figure without adding extra spacing before the caption
\newenvironment{figcenter}
{%
	\parskip=0pt%
	\par%
	\nopagebreak%
	\centering%
}%
{%
	\par%
	\noindent%
	\ignorespacesafterend%
}

%
% Styling, Layout
%

\setbeamercovered{invisible}
\beamertemplatenavigationsymbolsempty
\condensedToc

% Remove subsection bar
\defbeamertemplate*{headline}{miniframes theme no subsection}
{%
	\begin{beamercolorbox}[colsep=1.5pt]{upper separation line head}
	\end{beamercolorbox}
	\begin{beamercolorbox}{section in head/foot}
		\vskip-5pt\insertnavigation{\paperwidth}\vskip5pt
	\end{beamercolorbox}%
	\begin{beamercolorbox}[colsep=1.5pt]{lower separation line head}
	\end{beamercolorbox}
}

\defbeamertemplate{description item}{align left}{\insertdescriptionitem\hfill}

%
% Metadata
%

\title[Master's thesis -- Colloquium]{A Hybrid Algorithm for Finding Shortest Paths Between Arbitrary Coordinates using a Combination of Network and Geometric Routing}
\author{Hauke Stieler}
\institute[Universität Hamburg -- Databases and Information Systems]{
	Universität Hamburg\\
	Faculty of Mathematics, Informatics and Natural Sciences\\
	Department of Informatics\\
	Databases and Information Systems
}
\date{\today}
\titlegraphic{\includegraphics[width=0.3\textwidth]{../thesis/images/UHH-Logo_2010_Farbe_CMYK.pdf}}

\begin{document}
	{
		\setbeamertemplate{headline}{}
		\setbeamertemplate{footline}{}
		\vspace*{-0.65cm}
		\maketitle
		\addtocounter{page}{-1}
	}
	
	\begin{frame}[t]{Inhalt}
		\tableofcontents[hidesubsections]
	\end{frame}
	
	\section{Motivation}
	
		\begin{frame}{Realistic pedestrian routing}
			Beneficial for\n
			\begin{itemize}
				\item real-world end-user applications\\\textrightarrow\ indoor navigation, campus navigation
				\pause
				\item higher level applications\\\textrightarrow\ isochrones, walkability analysis
				\pause
				\item \textbf{agent-based simulations}\\\textrightarrow\ crowd behavior in evacuation scenario
			\end{itemize}
		\end{frame}
	
		\begin{frame}{Routing techniques}
			Graph-based:\n
			\begin{itemize}
				\item graph with edges representing roads / ways
				\item well optimized: Dijkstra, A*, speedup techniques
				\item detailed attributes in edges
				\pause
				\item only vertices are reachable\ \textrightarrow\ unable to traverse open spaces
			\end{itemize}
			\nn
			\pause
			Geometric routing:\n
			\begin{itemize}
				\item shortest path in presence of obstacles (i.e. lines and polygons)
				\item two strategies:
				\begin{itemize}
					\item graph generation (e.g. visibility graphs) + graph-based routing
					\item continuous Dijkstra
				\end{itemize}
				\pause
				\item path realism heavily depends on data quality
			\end{itemize}
		\end{frame}
	
		\begin{frame}{Example: Pure graph-based routing}
			\begin{figure}[t]
				\begin{figcenter}
					\includegraphics[width=0.65\textwidth]{images/qgis-routing-osterstrasse_routing.pdf}
				\end{figcenter}
				\caption{Graph-based routing result using \href{https://www.osm.org/directions?engine=graphhopper\_foot\&route=53.57657,9.95210;53.57601,9.95268}{\emph{GraphHopper}}.}
			\end{figure}
		\end{frame}
		
		\begin{frame}{Example: Expected routing behavior}
			\begin{figure}[t]
				\begin{figcenter}
					\includegraphics[width=0.65\textwidth]{images/qgis-routing-osterstrasse_expected.pdf}
				\end{figcenter}
				\caption{Routes an actual pedestrian would likely choose.}
			\end{figure}
		\end{frame}
		
%		\begin{frame}{Example 2: Densely built-up areas}
%			\begin{figure}[t]
%				\begin{figcenter}
%					\includegraphics[width=0.65\textwidth]{images/qgis-routing-similar.pdf}
%				\end{figcenter}
%				\caption{Expected routes often follow graph edges, which hold valuable information.}
%			\end{figure}
%		\end{frame}
		
		\begin{frame}{Value of graph data}
			Graph data is still valuable:\n
			\begin{itemize}
				\item detailed information
				\begin{itemize}
					\item surface conditions, access restrictions, allowed vehicle types
				\end{itemize}
				\item definitely walkable
				\begin{itemize}
					\item no real-world obstacles in the way
				\end{itemize}
				\item sometimes without alternatives
				\begin{itemize}
					\item bridges, tunnels
					\item paths through obstacles (e.g. building passages)
				\end{itemize}
			\end{itemize}
		\end{frame}
	
	\section{Design}
	
		\begin{frame}{Wanted routing algorithm}
			Should be able to\n
			\begin{itemize}
				\item traverse open spaces\ \textrightarrow\ reach arbitrary locations
				\item use roads and ways
				\item create more realistic routes than purely graph-based routing
			\end{itemize}
			\nn
			\pause
			Additional requirements:\n
			\begin{itemize}
				\item based on C\# / .NET and MARS (Multi-Agent Research and Simulation)
				\item low impact on simulation time
			\end{itemize}
		\end{frame}
		
		\begin{frame}{Design decisions}
			Decisions of implemented algorithm:\n
			\begin{itemize}
				\item visibility graph generation
				\item merge with existing road network
				\item connect source / destination with visibility edges
				\item usage of graph-based routing
			\end{itemize}
			\nn
			\pause
			Alternative approaches:\n
			\begin{itemize}
				\item alternating routing with continuous Dijkstra
				\item merge of route segments in postprocessing step
				\item other graph-generation methods
				\begin{itemize}
					\item Voronoi diagrams, skeletonization
					\item ad-hoc generation (e.g. by using continuous Dijkstra)
				\end{itemize}
			\end{itemize}
		\end{frame}
		
		\begin{frame}{Components}
			\begin{figure}[t]
				\begin{figcenter}
					\includegraphics[width=0.95\textwidth]{images/components.pdf}
				\end{figcenter}
				\caption{Components of the implemented hybrid routing algorithm.}
			\end{figure}
		\end{frame}
		
		\begin{frame}{Graph generation}
			\begin{figure}[t]
				\begin{figcenter}
					\includegraphics[width=0.98\textwidth]{images/components-sequence-generation-short.pdf}
				\end{figcenter}
				\caption{Separate steps of the graph generation.}
			\end{figure}
		\end{frame}
		
		\begin{frame}{Routing}
			\begin{figure}[t]
				\begin{figcenter}
					\includegraphics[width=0.95\textwidth]{images/components-sequence-routing-short.pdf}
				\end{figcenter}
				\caption{Separate steps of answering a routing request.}
			\end{figure}
		\end{frame}
	
	\section{Implementation}
	
		\begin{frame}{Considerations and terminology}
			Key considerations:\n
			\begin{itemize}
				\item custom implementation that supports
				\begin{itemize}
					\item collinear vertices
					\item arbitrary obstacle geometries (especially lines and polygons)
					\item intersecting obstacles
					\item arbitrary positions and non-unique coordinates
				\end{itemize}
				\item generate and connect nodes suitable for routing
			\end{itemize}
			\nn
			\pause
			Terminology:\n
			\begin{description}[visibility neighbor]
				\item[obstacle neighbor] vertex on same or touching obstacle
				\item[visibility neighbor] vertex across open space that is visible
				\item[input vertex] vertex / coordinate in the input dataset
				\item[output vertex] generated vertex in the visibility graph
			\end{description}
		\end{frame}
		
		\begin{frame}{Preparations}
			Before visibility graph is created:\n
			\begin{itemize}
				\item get obstacles from input data
				\item unwrap multi-geometries
				\item triangulate polygonal obstacles
				\begin{itemize}
					\item[\textrightarrow] performance optimization
				\end{itemize}
			\end{itemize}
		\end{frame}
		
		\begin{frame}{Visibility graph creation}
			\begin{enumerate}
				\item get obstacles from input data
				\item obtain data for visibility graph
				\begin{enumerate}
					\item for each vertex: determine its visibility neighbors
					\item sort visibility neighbors into bins based on obstacle neighbors
				\end{enumerate}
				\item generate routable visibility graph
				\item merge road edges
			\end{enumerate}
		\end{frame}
		
		\begin{frame}{Visibility graph creation: vertex and edge creation}
			Naive approach:
			\begin{itemize}
				\item one vertex per input coordinate
				\item routing through line-based obstacles possible
			\end{itemize}
			\nn
			\pause
			Correct approach:
			\begin{itemize}
				\item one vertex between adjacent obstacle neighbors
				\item multiple vertices at same location
				\item vertices are not connected
				\item routing through obstacle not possible
			\end{itemize}
		\end{frame}
	
		\begin{frame}{Visibility graph creation: vertex and edge creation}
			\begin{figure}
				\begin{figcenter}
					\scalebox{0.7}
					{
						\input{../thesis/images/tikz-visibility-neighbor-bins.tex}
					}
				\end{figcenter}
				\caption{Sorting visibility neighbors into bins, based on the obstacle neighbors of $v$.}
			\end{figure}
			\pause
			\begin{figure}
				\begin{figcenter}
					\scalebox{0.7}
					{
						\input{../thesis/images/tikz-vertex-creation-naive.tex}
					}
					\hspace{0.75cm}
					\scalebox{0.7}
					{
						\input{../thesis/images/tikz-vertex-creation-correct.tex}
					}
				\end{figcenter}
				\caption{Naive (left) and correct (right) vertex creation and connection.}
			\end{figure}
		\end{frame}
		
		\begin{frame}{Road network merge}
			\begin{enumerate}
				\item create vertices at intersection points
				\item connect new vertex
				\item remove old edges
			\end{enumerate}
			\begin{figure}
				\begin{figcenter}
					\scalebox{0.7}
					{
						\input{images/tikz-merge-before.tex}
					}
					\hspace{0.75cm}
					\scalebox{0.7}
					{
						\input{images/tikz-merge-after.tex}
					}
				\end{figcenter}
				\caption{Merge of road network and visibility edges.}
			\end{figure}
		\end{frame}
		
		\begin{frame}{Answering routing queries}
			\begin{enumerate}
				\item add vertices for source \& destination to graph
				\item create and add their visibility edges
				\begin{itemize}
					\item[\textrightarrow] same algorithm used for graph generation
				\end{itemize}
				\item use A* to determine shortest path
				\item remove previously created vertices and edges
			\end{enumerate}
		\end{frame}
		
		\begin{frame}{Performance optimizations}
			Only consider $k = k_b \cdot k_n$ many visibility neighbors:
			\begin{itemize}
				\item ensure neighbors exist in all directions
				\item $k_b$ bins, each covering $360 / k_b$ degree
				\item $k_n$ neighbors per bin
			\end{itemize}
			\nn
			\pause
			Only consider vertices on a convex hull:\n
			\begin{itemize}
				\item convex hull is shortest path around polygon
				\item[\textrightarrow\hspace{-0.1cm}] vertex not on any convex hull will never be part of any shortest path
			\end{itemize}
		\end{frame}
		
		\begin{frame}{Performance optimizations}
			Only consider potential visibility neighbors at certain angles:\n
			\begin{itemize}
				\item consider shortest path $p$\ \textrightarrow\ no edges can be relaxed
				\item only vertices at certain angles are valid neighbors\ \textrightarrow\ valid angle area
			\end{itemize}
			\pause
			\begin{figure}[b]
				\begin{figcenter}
					\scalebox{0.7}
					{
						\input{../thesis/images/tikz-valid-angle-area.tex}
					}
				\end{figcenter}
				\caption{Valid angle areas (blue and green).}
			\end{figure}
		\end{frame}
		
		\begin{frame}{Performance optimizations}
			Exclude vertices in \enquote{shadow} of obstacles:\n
			\begin{itemize}
				\item consider vertex $v$ and think of it as light bulb
				\item obstacles cast shadow outwards, hiding vertices
			\end{itemize}
			\pause
			\begin{figure}[b]
				\begin{figcenter}
					\scalebox{0.7}
					{
						\input{../thesis/images/tikz-shadow-areas.tex}
					}
				\end{figcenter}
				\caption{Shadow area $S$ cast by obstacle $o$.}
			\end{figure}
		\end{frame}
		
		\begin{frame}{Performance optimizations}
			Interval data structure for shadow areas:\n
			\begin{itemize}
				\item bin-based: each bin covers certain angle interval
				\item constant-time bin access
			\end{itemize}
			\begin{figure}[b]
				\begin{figcenter}
					\scalebox{0.7}
					{
						\input{../thesis/images/tikz-bin-index.tex}
					}
				\end{figcenter}
				\caption{BinIndex data structure storing two overlapping intervals.}
			\end{figure}
		\end{frame}
		
		\begin{frame}{Performance optimizations}
			Additional optimizations:
			\begin{itemize}
				\item usage of spatial indices
				\item custom line segment intersection check
				\item custom triangle intersection check
			\end{itemize}
		\end{frame}
	
	\section{Evaluation}
	
		\begin{frame}{Optimization impact}
			\begin{table}
				\begin{tabularx}{0.8\textwidth}{p{4.25cm}RR}
\toprule
\textbf{Enabled optimization}	& \textbf{Time}	& \textbf{Speedup}	\\
\midrule
Shadow areas					&  22.2 s		& 35.56				\\
kNN filtering					& 751.7 s		&  1.05				\\
Vertices on convex hull			& 287.9 s		&  2.74				\\
Valid angle areas				& 322.5 s		&  2.44				\\
Custom collision detection		& 769.3 s		&  1.02				\\
\midrule
No active optimization			& 788.5 s		&  1.00				\\
All optimizations active		&  11.1 s		& 71.13				\\
\bottomrule
				\end{tabularx}
				\caption{Impact of optimizations on the graph generation using the 0.5 km\textsuperscript{2} \enquote{OSM city} dataset.}
				\label{table:optimization-impact}
			\end{table}
		\end{frame}
		
		\begin{frame}{Graph generation task performance}
			\begin{figure}
				\begin{figcenter}
					\hspace*{-0.35cm}
					\scalebox{0.7}
					{
						\input{../thesis/images/evaluation/osm-based-rural/plot-no-roads-obstacles.py_absolute.pgf}
					}
				\end{figcenter}
				\caption{Time of graph generation tasks on different variants of the 4 km\textsuperscript{2} \enquote{OSM city} dataset.}
			\end{figure}
		\end{frame}
		
%		\begin{frame}{Graph generation task performance}
%			\begin{table}
%				\begin{tabularx}{\textwidth}{p{2.925cm}>{\raggedleft\arraybackslash}p{2.075cm}R>{\raggedleft\arraybackslash}p{2.2cm}}
%\toprule
%\textbf{Operation}	& \textbf{Normal}	& \textbf{No roads}	& \textbf{No obstacles}	\\
%\midrule
%kNN search			&  5,957.97 ms		& 5,924.27 ms		&  0.01 ms				\\
%Create graph		&    191.68 ms		&   210.40 ms		&  0.01 ms				\\
%Get obstacles		&     42.53 ms		&    40.76 ms		&  0.78 ms				\\
%Merge road edges	&  6,599.78 ms		&     5.67 ms		& 32.79 ms				\\
%Add POI attributes	&      4.83 ms		&     1.53 ms		&  0.42 ms				\\
%\midrule
%Total time			& 12,853.51 ms		& 6,201.96 ms		& 37.19 ms				\\
%\bottomrule
%				\end{tabularx}
%				\caption{Time of graph generation tasks on different variants of the 4 km\textsuperscript{2} \enquote{OSM city} dataset.}
%			\end{table}
%		\end{frame}

		\begin{frame}{Graph generation task performance}
			\begin{figure}
				\begin{figcenter}
					\hspace*{-0.35cm}
					\scalebox{0.7}
					{
						\input{../thesis/images/evaluation/osm-based-city/plot-import-details-per-vertices.py_absolute.pgf}
					}
				\end{figcenter}
				\caption{Time of graph generation tasks on all \enquote{OSM city} datasets.}
			\end{figure}
		\end{frame}
		
		\begin{frame}{Graph generation task performance}
			\begin{figure}
				\begin{figcenter}
					\hspace*{-0.35cm}
					\scalebox{0.7}
					{
						\input{../thesis/images/evaluation/osm-based-city/plot-routing-time-details.py_absolute_45018.pgf}
					}
				\end{figcenter}
				\caption{Time needed by routing task for differently distant requests using the 4 km\textsuperscript{2} \enquote{OSM city} dataset.}
			\end{figure}
		\end{frame}
	
	\section{Conclusion}
\end{document}